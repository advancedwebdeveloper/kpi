kotlin {
    linuxArm32Hfp('zero') {
        compilations.main {
            cinterops { bcm2835 }
        }
        binaries {
            executable('gpio') {
                entryPoint 'uk.tvidal.kpi.gpio.main'
            }
            executable('pwm') {
                entryPoint 'uk.tvidal.kpi.pwm.main'
            }
        }
    }

    linuxArm32Hfp('wiring') {
        compilations.main {
            cinterops { wiringpi }
        }
        binaries {
            executable('gpio') {
                entryPoint 'uk.tvidal.kpi.gpio.main'
            }
            executable('pwm') {
                entryPoint 'uk.tvidal.kpi.pwm.main'
            }
        }
    }
}

task uploadToPi(type: Exec) {
    inputs.dir file("$buildDir/bin/zero")
    ignoreExitValue true
    workingDir "$buildDir/bin"
    executable 'sh'
    args '-c', "rsync -qrl zero/*DebugExecutable/*.kexe 'pi@$pi_host:~'"
}
build.dependsOn uploadToPi
